<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rashed Al-Majed | راشد الماجد</title>
    
    <link rel="icon" type="image/jpeg" href="channels4_profile.jpg">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #0b0f1a; color: white; overflow: hidden; }
        .glass-player { background: rgba(10, 10, 10, 0.98); backdrop-filter: blur(15px); border-top: 1px solid #1f2937; }
        .song-card { background: rgba(31, 41, 55, 0.3); transition: all 0.3s ease; border: 1px solid rgba(255,255,255,0.05); }
        .song-card:hover { background: rgba(79, 70, 229, 0.15); transform: translateY(-2px); border-color: #4f46e5; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 10px; }
        input[type="range"] { accent-color: #4f46e5; cursor: pointer; }
    </style>
</head>
<body class="h-screen flex flex-col">

    <header class="p-4 md:p-6 border-b border-gray-800 flex flex-col md:flex-row justify-between items-center bg-gray-900/50 gap-4">
        <div class="text-center md:text-right">
            <h1 class="text-2xl font-bold text-indigo-500 tracking-wide">Rashed Al-Majed</h1>
            <p class="text-[15px] text-gray-400 font-mono mt-1 italic">جميع أغاني السندباد في مكانٍ واحد </p>
        </div>
        <div class="relative w-full md:w-1/3">
            <input type="text" id="searchInput" oninput="searchSongs()" placeholder="ابحث في أغاني السندباد..." 
                   class="w-full bg-gray-800 border-none rounded-full py-2 px-10 focus:ring-2 focus:ring-indigo-500 outline-none text-sm text-right">
            <i class="fas fa-search absolute right-4 top-3 text-gray-500"></i>
        </div>
    </header>

    <main class="flex-1 overflow-y-auto p-4 md:p-8 pb-40 md:pb-32">
        <div id="songsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
            <div id="loader" class="col-span-full text-center py-20">
                <i class="fas fa-compact-disc fa-spin text-4xl text-indigo-500 mb-4"></i>
                <p class="text-gray-400">جاري الاتصال بمكتبة السندباد...</p>
            </div>
        </div>
    </main>

    <footer class="fixed bottom-0 w-full glass-player px-4 md:px-8 py-4 md:h-24 flex flex-col md:flex-row items-center justify-between z-50 gap-4">
        <div class="flex items-center gap-4 w-full md:w-1/4 overflow-hidden">
            <div class="w-12 h-12 md:w-14 md:h-14 bg-gray-800 rounded-lg flex items-center justify-center overflow-hidden border border-indigo-500/20 shrink-0 shadow-lg">
                <img id="nowPlayingImg" src="" class="hidden w-full h-full object-cover">
                <i id="defaultMusicIcon" class="fas fa-music text-indigo-400 text-xl"></i>
            </div>
            <div class="truncate">
                <div id="nowPlayingTitle" class="font-bold text-sm truncate leading-tight text-gray-100 italic">بانتظار اختيار أغنية</div>
                <div id="nowPlayingArtist" class="text-xs text-gray-500">بإنتظار الفنان</div>
            </div>
        </div>

        <div class="flex flex-col items-center gap-2 w-full md:w-1/2">
            <audio id="audioPlayer" ontimeupdate="updateProgress()"></audio>
            <div class="flex items-center gap-6 md:gap-8">
                <button class="text-gray-400 hover:text-white transition"><i class="fas fa-random"></i></button>
                <button class="text-xl text-gray-200 hover:text-indigo-400"><i class="fas fa-step-backward"></i></button>
                <button id="playBtn" onclick="togglePlay()" class="w-12 h-12 md:w-14 md:h-14 bg-white text-black rounded-full flex items-center justify-center hover:scale-110 transition shadow-lg">
                    <i id="playIcon" class="fas fa-play ml-1 text-lg"></i>
                </button>
                <button class="text-xl text-gray-200 hover:text-indigo-400"><i class="fas fa-step-forward"></i></button>
                <button class="text-gray-400 hover:text-white transition"><i class="fas fa-redo"></i></button>
            </div>
            <div class="w-full max-w-lg flex items-center gap-3">
                <span id="currentTime" class="text-[10px] text-gray-500 font-mono">0:00</span>
                <input type="range" id="progressRange" value="0" min="0" max="100" oninput="seekAudio()" class="flex-1 h-1 bg-gray-700 rounded-full appearance-none">
                <span id="durationTime" class="text-[10px] text-gray-500 font-mono">0:00</span>
            </div>
        </div>

        <div class="hidden md:flex w-1/4 justify-end items-center gap-4 text-gray-400">
            <i class="fas fa-volume-up"></i>
            <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="1" oninput="setVolume(this.value)" class="w-20 h-1 bg-gray-700 rounded-full appearance-none">
        </div>
    </footer>

    <script>
        const SUPABASE_URL = 'https://rvenozcywkdwvjichwoi.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_jpxnDBGDzs0kqj7MjbEUQQ_UxrTKJnp'; 
        
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        let allSongs = [];

        async function loadSongs() {
            try {
                const { data, error } = await _supabase.from('songs').select('*');
                if (error) throw error;
                allSongs = data || [];
                displaySongs(allSongs);
            } catch (err) {
                document.getElementById('songsGrid').innerHTML = `
                    <div class="col-span-full text-center p-10 bg-red-900/10 border border-red-500/30 rounded-2xl">
                        <i class="fas fa-exclamation-circle text-red-500 text-2xl mb-3"></i>
                        <p class="text-red-200 text-sm italic">خطأ في جلب البيانات: ${err.message}</p>
                    </div>`;
            }
        }

        function displaySongs(songs) {
            const grid = document.getElementById('songsGrid');
            if (songs.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-20 border-2 border-dashed border-gray-800 rounded-3xl">
                        <i class="fas fa-check-circle text-3xl text-indigo-500 mb-4"></i>
                        <p class="text-gray-400 mb-1 font-bold">تم الاتصال بالسيرفر بنجاح ✅</p>
                        <p class="text-indigo-400 text-xs">الجدول حاليًا فاضي .. بانتظار اكتمال رفع جميع الأغاني ياحلو.</p>
                    </div>`;
                return;
            }
            grid.innerHTML = songs.map(song => `
                <div onclick="playSong('${song.drive}', '${song.title}', '${song.artist}', '${song.cover}')" class="song-card p-4 rounded-2xl cursor-pointer flex items-center gap-4 group">
                    <div class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center text-indigo-500 group-hover:bg-indigo-600 group-hover:text-white transition shadow-inner">
                        <i class="fas fa-play text-xs"></i>
                    </div>
                    <div class="truncate flex-1">
                        <p class="font-bold text-sm truncate text-gray-100">${song.title || 'أغنية لراشد'}</p>
                        <p class="text-[11px] text-gray-500 truncate">${song.artist || 'راشد الماجد'}</p>
                    </div>
                </div>
            `).join('');
        }

        function searchSongs() {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = allSongs.filter(s => 
                (s.title && s.title.toLowerCase().includes(term)) || 
                (s.artist && s.artist.toLowerCase().includes(term))
            );
            displaySongs(filtered);
        }

        function playSong(url, title, artist, cover) {
            const audio = document.getElementById('audioPlayer');
            const img = document.getElementById('nowPlayingImg');
            const icon = document.getElementById('defaultMusicIcon');
            
            let directLink = url;
            if (url && (url.includes('id=') || url.includes('/d/'))) {
                const id = url.includes('id=') ? url.split('id=')[1].split('&')[0] : url.split('/d/')[1].split('/')[0];
                directLink = `https://docs.google.com/uc?export=download&id=${id}`;
            }

            audio.src = directLink;
            audio.play();

            document.getElementById('nowPlayingTitle').innerText = title;
            document.getElementById('nowPlayingArtist').innerText = artist || 'راشد الماجد';
            
            if (cover && cover !== "null") {
                img.src = cover; img.classList.remove('hidden'); icon.classList.add('hidden');
            } else {
                img.classList.add('hidden'); icon.classList.remove('hidden');
            }
            document.getElementById('playIcon').className = 'fas fa-pause';
        }

        function togglePlay() {
            const audio = document.getElementById('audioPlayer');
            if (!audio.src) return;
            if (audio.paused) { audio.play(); document.getElementById('playIcon').className = 'fas fa-pause'; }
            else { audio.pause(); document.getElementById('playIcon').className = 'fas fa-play ml-1'; }
        }

        function updateProgress() {
            const audio = document.getElementById('audioPlayer');
            const progress = document.getElementById('progressRange');
            if (audio.duration) {
                progress.value = (audio.currentTime / audio.duration) * 100;
                document.getElementById('currentTime').innerText = formatTime(audio.currentTime);
                document.getElementById('durationTime').innerText = formatTime(audio.duration);
            }
        }

        function seekAudio() {
            const audio = document.getElementById('audioPlayer');
            const progress = document.getElementById('progressRange');
            audio.currentTime = (progress.value / 100) * audio.duration;
        }

        function setVolume(val) { document.getElementById('audioPlayer').volume = val; }
        function formatTime(secs) {
            const mins = Math.floor(secs / 60);
            const s = Math.floor(secs % 60);
            return `${mins}:${s < 10 ? '0' : ''}${s}`;
        }

        window.onload = () => { document.getElementById('audioPlayer').volume = 1; };
        loadSongs();
    </script>
</body>
</html>
